/* Copyright (c) 2021 AWE ****************************************************
'*  Name:        book.js 
'*  Description: Global javascipt snippets.
'*  Email:       wilson.wampers@gmail.com
'*****************************************************************************
'*  Modification History:
'*  -When           -Who            -Bug#           -What
'*  --------------------------------------------------------------------------
'*	-18-Mar-2021    -Wilson Wampers -               -Initial Version
'****************************************************************************/
console.log('book.js -> loaded.');

//****************************************************************************
console.log('IE version:' + global.IEVersion);
var MutationObserver = MutationObserver || {};
var HashChangeEvent = HashChangeEvent || {};
if(global.IEVersion > -1) window.onerror = function() { ; }

//****************************************************************************
// Desc: 
//****************************************************************************
function findBookmarkFromHash()
{
    console.log('findBookmarkFromHash');
    var sHref = window.location.href;
    var spl = sHref.indexOf('#');
    var saName = sHref.substr(spl+1,(sHref.length - spl));
    if(spl > 0)
    {
        $('a[name="'+saName+'"]').closest('h3 + div').show();
        updateParentsClass(saName);
    }
}

//****************************************************************************
// Desc: 
//****************************************************************************
function updateParentsClass(psaName)
{
    console.log('updateParentsClass -> #' + psaName);
    var oParent = $('a[name="'+psaName+'"]').closest('h3 + div').prev();

    if(!oParent.hasClass('expanded'))
    {
        oParent.addClass('expanded'); 
    }

    window.location = window.location;
}

//****************************************************************************
// Desc: addHashChange(function(e){alert(e.newURL||location.href);});
//****************************************************************************
function checkBookmark()
{
    console.log('checkBookmark');
    if(location.href.indexOf('#') != -1)
    {
        if(global.IEVersion == -1)
        {
            window.dispatchEvent(new HashChangeEvent("hashchange"));
        }
        else
        {
            setTimeout(findBookmarkFromHash(), 2000);
        }
    }           
}

//****************************************************************************

if(global.IEVersion == -1)
{
    window.dispatchEvent(new HashChangeEvent("hashchange"));
}

window.addEventListener('hashchange', 
function() 
{
    findBookmarkFromHash();
}, false);

window.onload = checkBookmark;

//****************************************************************************