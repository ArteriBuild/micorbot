/* Copyright (c) 2021 AWE ****************************************************
'*  Name:        fbnf.js  
'*  Description: Global javascipt snippets.
'*  Email:       wilson.wampers@gmail.com
'*****************************************************************************
'*  Modification History:
'*  -When           -Who            -Bug#           -What
'*  --------------------------------------------------------------------------
'*	-28-Jul-2021    -Wilson Wampers -               -Initial Version
'****************************************************************************/
// LM: ww221222.2021_P
var fbn = fbn || {}, styleSheet;

styleSheet = global.micor2020Path + 'css/fbnf.css';
             global.loadCss(styleSheet);

fbn.formTYTitle    = 'Thank you for your feedback';
fbn.line_1         = 'We\'ve emailed you a copy of your feedback and';
fbn.line_2         = 'someone of our team will address your message as';
fbn.line_3         = 'soon as possible';
fbn.yesNoLabel     = 'Yes';
fbn.formType       = '';
fbn.emailAddress   = '';
fbn.userSelHtml    = '';
fbn.userSelection  = {};
fbn.encodeUri      = '';
fbn.isLoaded       = false;

var MutationObserver = MutationObserver || {};

//****************************************************************************
// Desc:
//****************************************************************************
fbn.init = function(psFormSwitch)
{
    var sHtml = '', userSelection = {}, encodedUri;

    fbn.isLoaded = true;
    fbn.formSwitch = psFormSwitch;
    userSelection = {"outputText": fbn.getUserSelected(), "ouputHtml": fbn.userSelHtml};
    fbn.userSelection = JSON.stringify(userSelection);
    fbn.encodedUri = encodeURI('/pages/website-feedback.aspx?Key='+ psFormSwitch);
    $(document).ready(function()
    {
        console.log('➡️-> feedback new form: loaded.');

        if( $('#bgLayer').length == 0 )
        {
            $('div.aspNetHidden').before('<div id="bgLayer" class="fullMask" style="display: none;"></div>');
        }
        else
        {
            if($('div#fbnThankYou').length != 0)   $('div#fbnThankYou').remove();
            if($('div#fbnContainer').length != 0)  $('div#fbnContainer').remove();
        }
        sHtml =  '';
        sHtml += '<div id="fbnContainer" class="fbnContainer">';
        sHtml += '    <div id="fbnDialog" class="fbnDialog">';
        sHtml += '        <iframe id="feedbackWidget" scrolling="no" frameborder="0"';
        sHtml += ' class="cornersWithShadow flexBehaviorRowWrap"></iframe>';
        sHtml += '    </div>';
        sHtml += '</div>';

        $('#bgLayer').prepend(sHtml);
        $('#bgLayer').show();
        $('iframe#feedbackWidget').prop('src', fbn.encodedUri);      
    });
}

//****************************************************************************
// Desc:
//****************************************************************************
fbn.showIframe = function()
{
    $('div#fbnContainer').show();
    if(global.IEVersion == -1)
    {
        $('iframe#feedbackWidget').fadeIn(1, 'swing', 
        function()
        {
            $('iframe#feedbackWidget').css({visibility: 'visible'});
            setTimeout(function() 
            {
                $('iframe#feedbackWidget').css({left: '0px'});       
            }, 1000);
        }, 1000);
    }
    else // IE
    {
        $('iframe#feedbackWidget').fadeIn(1, 'swing', 
        function()
        {
            $('iframe#feedbackWidget').css({visibility: 'visible'});
            setTimeout(function() 
            {
                $('iframe#feedbackWidget').css({left: '0px', 'z-index':99});       
            }, 2000);
        });
    }
}

//****************************************************************************
// Desc:fbn._Close
//****************************************************************************
fbn._Close = function()
{   
    if(fbn.formSwitch == 'Thank-You')
    {
        $('div#fbnContainer').fadeOut(300);
        setTimeout( function() {fbn.thankYou();}, 300);
    }
    else
    {
        $('#bgLayer').fadeOut(100, 'linear', function()
        {
            $('div#fbnContainer').remove();
            $('div#bgLayer').removeClass('fmLoading');  
        });
    }
}

//****************************************************************************
// Desc: /\r?\n|\r/g
//****************************************************************************
fbn.getUserSelected = function()
{
    var sUserSelected = $('footer > div.outputText').text()
                        .replace(/\r?\n|\r/g, '')
                        .replace(/&ZeroWidthSpace/g, '')
                        .replace(/  +/g, ' ');

    return sUserSelected;
}

//****************************************************************************
// Desc: /\r?\n|\r/g
//****************************************************************************
fbn.getUserHtml = function()
{
    return $('div.outputHtml').html();
}

//****************************************************************************
// Desc:
//****************************************************************************
fbn.thankYou = function()
{
    var sHtml = '';

    sHtml += '<div id="fbnThankYou" class="fbnThankYou">';
    sHtml += '    <div id="fbnDialogTY" class="fbnDialogTY cornersWithShadow flexBehaviorRowWrap">';
    sHtml += '      <div id="btnCloseTY" title="Click to close" ><div class="closeBtnTY">';
    sHtml += '<svg width="19" height="19" viewBox="0 0 19 19" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.5418 2.27956L16.7206 0.458313L9.50016 7.67873L2.27975 0.458313L0.458496 2.27956L7.67891 9.49998L0.458496 16.7204L2.27975 18.5416L9.50016 11.3212L16.7206 18.5416L18.5418 16.7204L11.3214 9.49998L18.5418 2.27956Z" fill="black"/></svg>';
    sHtml += '</div></div>';
    sHtml += '      <h3 class="dialogTitleTY">' + fbn.formTYTitle + '</h3>';
    sHtml += '      <div id="fbnContent" class="fbnContentTY">';
    sHtml += '          <table id="fbnTY" class="fbnTY">';
    sHtml += '            <tr><td class="btnSpacer">&nbsp;</td></tr>';
    sHtml += '            <tr>';
    sHtml += '              <td class="fbnTYline">'+ fbn.line_1+'</td>';
    sHtml += '            </tr>';
    sHtml += '            <tr>';
    sHtml += '              <td class="fbnTYline">'+ fbn.line_2+'</td>';
    sHtml += '            </tr>';
    sHtml += '            <tr>';
    sHtml += '              <td class="fbnTYline">'+ fbn.line_3+'</td>';
    sHtml += '            </tr>';
    sHtml += '            <tr><td class="btnSpacer">&nbsp;</td></tr>';
    sHtml += '            <tr>';
    sHtml += '              <td class="fbnTYbtn"><input id="inpCloseTY" type="button" value="Close window" /></td>';
    sHtml += '            </tr>';
    sHtml += '          </table>';
    sHtml += '      </div>';
    sHtml += '    </div>';
    sHtml += '</div>';

    $('#bgLayer').prepend(sHtml);
    $('#bgLayer').fadeIn(450);
    $('div.closeBtnTY').on('click', function() 
    { 
        fbn.formSwitch = '';
        fbn._Close(); 
    });
    $('input#inpCloseTY').on('click', function() 
    { 
        fbn.formSwitch = '';
        fbn._Close(); 
    });
}

//****************************************************************************